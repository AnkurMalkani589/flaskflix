{% extends "base.html" %}

{% block title %}{{ movie.title }} - FlaskFlix{% endblock %}

{% block content %}
<div class="row movie-detail-section">
    <div class="col-12 col-md-4 mb-4 mb-md-0">
        <div class="movie-poster-container">
            {% if movie.trailer_url %}
            <a href="#" data-bs-toggle="modal" data-bs-target="#trailerModal" class="d-block">
                <img src="{{ movie.poster }}" alt="{{ movie.title }}" class="movie-detail-poster rounded w-100" style="max-width: 400px;" onerror="this.src='https://via.placeholder.com/400x600/141414/e50914?text=FlaskFlix'">
            </a>
            {% else %}
            <img src="{{ movie.poster }}" alt="{{ movie.title }}" class="movie-detail-poster rounded w-100" style="max-width: 400px;" onerror="this.src='https://via.placeholder.com/400x600/141414/e50914?text=FlaskFlix'">
            {% endif %}
        </div>
    </div>
    <div class="col-12 col-md-8">
        <h1 class="display-5 mb-3">{{ movie.title }}</h1>
        <div class="d-flex flex-wrap gap-3 mb-3">
            <span class="badge bg-danger">{{ movie.category }}</span>
            <span class="text-light">{{ movie.release_year }}</span>
            {% if movie.rating > 0 %}
            <span class="rating">‚≠ê {{ movie.rating }}/10</span>
            {% endif %}
        </div>
        
        <p class="lead">{{ movie.description }}</p>
        
        <div class="mt-4 d-flex flex-wrap gap-2">
            {% if current_user.is_authenticated %}
                {% if in_watchlist %}
                <a href="{{ url_for('watchlist.remove', movie_id=movie.id) }}" class="btn btn-outline-danger">Remove from Watchlist</a>
                {% else %}
                <a href="{{ url_for('watchlist.add', movie_id=movie.id) }}" class="btn btn-danger">Add to Watchlist</a>
                {% endif %}
                
                {% if has_streaming %}
                <a href="{{ url_for('movies.watch', movie_id=movie.id) }}" class="btn btn-success">
                    <span class="me-1">&#9658;</span> Watch Now
                </a>
                {% endif %}
            {% endif %}
            
            {% if current_user.is_authenticated and current_user.is_admin %}
            <a href="{{ url_for('movies.edit', movie_id=movie.id) }}" class="btn btn-outline-warning">Edit Movie</a>
            <button type="button" class="btn btn-outline-danger" data-bs-toggle="modal" data-bs-target="#deleteModal">Delete</button>
            {% endif %}
        </div>
        
        {% if has_streaming and current_user.is_authenticated %}
        <div class="mt-3">
            <a href="{{ url_for('movies.watch', movie_id=movie.id) }}" class="text-success fw-bold">
                &#9658; Click here to watch full movie
            </a>
        </div>
        {% endif %}
    </div>
</div>


<!-- Trailer Modal -->
{% if movie.trailer_embed_url %}
<div class="modal fade" id="trailerModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content bg-dark">

            <div class="modal-header">
                <h5 class="modal-title">{{ movie.title }} - Trailer</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>

            <div class="modal-body p-0">
                <div class="ratio ratio-16x9">

                    <iframe 
                        src="{{ movie.trailer_embed_url }}"
                        title="Trailer"
                        allowfullscreen>
                    </iframe>

                </div>
            </div>

        </div>
    </div>
</div>
{% endif %}



<!-- Delete Modal -->
{% if current_user.is_authenticated and current_user.is_admin %}
<div class="modal fade" id="deleteModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content bg-dark">
            <div class="modal-header">
                <h5 class="modal-title">Confirm Delete</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                Are you sure you want to delete "{{ movie.title }}"?
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <form action="{{ url_for('movies.delete', movie_id=movie.id) }}" method="POST">
                    <button type="submit" class="btn btn-danger">Delete</button>
                </form>
            </div>
        </div>
    </div>
</div>
{% endif %}

<style>
/* .play-button-overlay {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 70px;
    height: 70px;
    background: rgba(229, 9, 20, 0.9);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    transition: opacity 0.3s ease;
    cursor: pointer;
} */

.movie-detail-poster {
    position: relative;
    cursor: pointer;
    transition: transform 0.3s ease;
}

.movie-detail-poster:hover {
    transform: scale(1.02);
}

/* .movie-detail-poster:hover + .play-button-overlay,
.movie-detail-poster:hover .play-button-overlay {
    opacity: 1;
} */

/* .play-icon {
    font-size: 30px;
    color: white;
    margin-left: 5px;
} */
</style>
{% endblock %}

<script>
document.getElementById('trailerModal')?.addEventListener('hidden.bs.modal', function () {
    const iframe = this.querySelector('iframe');
    if (iframe) {
        iframe.src = iframe.src;
    }
});
</script>
